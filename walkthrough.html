

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Example Walkthrough &#8212; NMR-EsPy  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The NMR-EsPy GUI" href="gui/index.html" />
    <link rel="prev" title="Theory Overview" href="theory_overview.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gui/index.html" title="The NMR-EsPy GUI"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="theory_overview.html" title="Theory Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NMR-EsPy  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example Walkthrough</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <style>
   .grey {color:#808080}
   .red {color:#ff0000}
   .green {color:#008000}
   .blue {color:#0000ff}
   .oscblue {color:#1063e0}
   .oscorange {color:#eb9310}
   .oscgreen {color:#2bb539}
   .oscred {color:#d4200c}
   .regiongreen {color: #7fd47f}
   .regionblue {color: #66b3ff}
</style><section id="example-walkthrough">
<h1>Example Walkthrough<a class="headerlink" href="#example-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>This page provides an outline of basic NMR-EsPy usage through writing
Python code. If you wish to use the graphical user interface instead,
<a class="reference internal" href="gui/index.html"><span class="doc">follow this link</span></a>.</p>
<p>As an illustration of the typical steps involved in using NMR-EsPy, we will
consider an example dataset that ships with TopSpin 4. Assuming you installed
TopSpin in the default path, this should be present in the path:</p>
<ul class="simple">
<li><p>Linux: <code class="docutils literal notranslate"><span class="pre">/opt/topspin4.x.y/examdata/exam1d_1H/1/pdata/1</span></code></p></li>
<li><p>Windows: <code class="docutils literal notranslate"><span class="pre">C:\Bruker\TopSpin4.x.y\examdata\exam1d_1H\1\pdata\1</span></code></p></li>
</ul>
<p>In what follows, as I am using TopSpin 4.0.8, I shall be replacing
<code class="docutils literal notranslate"><span class="pre">topspin4.x.y</span></code> with <code class="docutils literal notranslate"><span class="pre">topspin4.0.8</span></code>.</p>
<p>I recommend that you follow this walkthrough using a Python
interpreter to ensure everything runs smoothly on your system.</p>
<section id="generating-an-estimator-instance">
<h2>Generating an Estimator instance<a class="headerlink" href="#generating-an-estimator-instance" title="Permalink to this headline">¶</a></h2>
<p>To get started, it is necessary to import the <a class="reference internal" href="references/core.html#nmrespy.core.Estimator" title="nmrespy.core.Estimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">nmrespy.core.Estimator</span></code></a>
class. A new instance of this class is initialised using the static
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.new_bruker" title="nmrespy.core.Estimator.new_bruker"><code class="xref py py-meth docutils literal notranslate"><span class="pre">new_bruker()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nmrespy.core</span> <span class="kn">import</span> <span class="n">Estimator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Specify the path to the directory containing 1r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/opt/topspin4.0.8/examdata/exam1d_1H/1/pdata/1&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="o">.</span><span class="n">new_bruker</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
<span class="go">&lt;class &#39;nmrespy.core.Estimator&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using Windows, you should also import and initialise <code class="docutils literal notranslate"><span class="pre">colorama</span></code>
to ensure that coloured output is possible. If you do not, you may see a
fair amount of gobbledygook:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">colorama</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">colorama</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Information about the estimator can be seen by printing it:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
<span class="go">&lt;nmrespy.core.Estimator at 0x7f50e8ad8fa0&gt;</span>
<span class="go">source : bruker_pdata</span>
<span class="go">data : [ 8237241.76470947      +0.j          1834272.48552552-9941412.67849912j</span>
<span class="go"> -7908307.89165751+1371281.69800517j ...</span>
<span class="go">        0.              +0.j                0.              +0.j</span>
<span class="go">        0.              +0.j        ]</span>
<span class="go">dim : 1</span>
<span class="go">n : [32768]</span>
<span class="go">path : /opt/topspin4.0.8/examdata/exam1d_1H/1/pdata/1</span>
<span class="go">sw : [5494.50549450549]</span>
<span class="go">offset : [2249.20599998768]</span>
<span class="go">sfo : [500.132249206]</span>
<span class="go">nuc : [&#39;1H&#39;]</span>
<span class="go">fmt : &lt;i4</span>
<span class="go">filter_info : None</span>
<span class="go">result : None</span>
<span class="go">errors : None</span>
</pre></div>
</div>
<p>An interactive plot of the data, in the frequency domain, can be seen using the
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.view_data" title="nmrespy.core.Estimator.view_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">view_data()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">view_data</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/view_data.png" class="align-center" src="_images/view_data.png" style="width: 803.2px; height: 700.0px;" />
</section>
<section id="frequency-filtration">
<h2>Frequency Filtration<a class="headerlink" href="#frequency-filtration" title="Permalink to this headline">¶</a></h2>
<p>For complex NMR signals, it is typically necessary to consider a subset of
the frequency space at any time, otherwise the computational burden would be
too large. To overcome this, it is possible to derive a time-domain signal
which has been generated via frequency-filtration.</p>
<p>In this example, I am going to focus on the spectral region between
5.54-5.42ppm. The region looks like this:</p>
<img alt="_images/spectral_region.png" class="align-center" src="_images/spectral_region.png" />
<p>To generate a frequency-filtered signal from the imported data, the
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.frequency_filter" title="nmrespy.core.Estimator.frequency_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">frequency_filter()</span></code></a> method is used. All well as
specifying the region of interest, it is also necessary to provide a region
that appears to contain no signals (this is used to gain an insight into the
data’s noise variance). In this example, I will set this region to be -0.15 to
-0.3ppm.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">frequency_filter</span><span class="p">([[</span><span class="mf">5.54</span><span class="p">,</span> <span class="mf">5.42</span><span class="p">]],</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">]])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be aware of the use of two sets of parentheses around the regions specified.
This may seem odd, but a nested list is required to ensure compatibility
with 2D data as well.</p>
</div>
</section>
<section id="estimating-the-signal-parameters">
<h2>Estimating the Signal Parameters<a class="headerlink" href="#estimating-the-signal-parameters" title="Permalink to this headline">¶</a></h2>
<section id="matrix-pencil-method">
<h3>Matrix Pencil Method<a class="headerlink" href="#matrix-pencil-method" title="Permalink to this headline">¶</a></h3>
<p>Now that a frequency filtered signal has been generated, we can begin the
estimation routine. Before estimating the signal parameters using nonlinear
programming (NLP), an initial guess of the parameters is required. We can derive
this guess using <a class="reference internal" href="references/core.html#nmrespy.core.Estimator.matrix_pencil" title="nmrespy.core.Estimator.matrix_pencil"><code class="xref py py-meth docutils literal notranslate"><span class="pre">matrix_pencil()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">matrix_pencil</span><span class="p">()</span>
<span class="go">============================</span>
<span class="go">MATRIX PENCIL METHOD STARTED</span>
<span class="go">============================</span>
<span class="go">--&gt; Pencil Parameter: 358</span>
<span class="go">--&gt; Hankel data matrix constructed:</span>
<span class="go">Size:   718 x 359</span>
<span class="go">Memory: 3.9331MiB</span>
<span class="go">--&gt; Performing Singular Value Decomposition...</span>
<span class="go">--&gt; Determining number of oscillators...</span>
<span class="go">    Number of oscillators will be estimated using MDL</span>
<span class="go">    Number of oscillations: 12</span>
<span class="go">--&gt; Determining signal poles...</span>
<span class="go">--&gt; Determining complex amplitudes...</span>
<span class="go">--&gt; Checking for oscillators with negative damping...</span>
<span class="go">    None found</span>
<span class="go"> =============================</span>
<span class="go"> MATRIX PENCIL METHOD COMPLETE</span>
<span class="go"> =============================</span>
<span class="go"> Time elapsed: 0 mins, 0 secs, 388 msecs</span>
</pre></div>
</div>
<p>The result of the estimation is stored within the <code class="docutils literal notranslate"><span class="pre">result</span></code> attribute,
which can be accessed using <a class="reference internal" href="references/core.html#nmrespy.core.Estimator.get_result" title="nmrespy.core.Estimator.get_result"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_result()</span></code></a>.</p>
</section>
<section id="nonlinear-programming">
<h3>Nonlinear Programming<a class="headerlink" href="#nonlinear-programming" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> attribute is next subjected to a NLP routine using the
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.nonlinear_programming" title="nmrespy.core.Estimator.nonlinear_programming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nonlinear_programming()</span></code></a> method. As the
frequency-filtered data was derived from well-phased spectral
data, the optional <code class="docutils literal notranslate"><span class="pre">phase_variance</span></code> argument is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>. The
optimisation routine will then ensure that the estimate’s phases are similar to
each other (and hopefully very close to 0), and will often remove excessive
oscillators from the Matrix Pencil result (note that our initial guess in
this example contains 12 oscillators).</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">nonlinear_programming</span><span class="p">(</span><span class="n">phase_variance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">=============================</span>
<span class="go">NONLINEAR PROGRAMMING STARTED</span>
<span class="go">=============================</span>
<span class="go">| niter |f evals|CG iter|  obj func   |tr radius |   opt    |  c viol  | penalty  |CG stop|</span>
<span class="go">|-------|-------|-------|-------------|----------|----------|----------|----------|-------|</span>
<span class="go">|   1   |   1   |   0   | +1.6287e-01 | 1.00e+00 | 9.30e-02 | 0.00e+00 | 1.00e+00 |   0   |</span>
<span class="go">|   2   |   2   |   1   | +9.0652e-02 | 7.00e+00 | 6.92e-01 | 0.00e+00 | 1.00e+00 |   2   |</span>
<span class="go">|   3   |   3   |   9   | +9.0652e-02 | 7.00e-01 | 6.92e-01 | 0.00e+00 | 1.00e+00 |   3   |</span>


<span class="go">--snip--</span>

<span class="go">|  100  |  100  |  966  | +6.4830e-04 | 1.27e-01 | 2.56e-03 | 0.00e+00 | 1.00e+00 |   2   |</span>

<span class="go">--snip--</span>

<span class="go">Negative amplitudes detected. These oscillators will be removed</span>
<span class="go">Updated number of oscillators: 9</span>
<span class="go">| niter |f evals|CG iter|  obj func   |tr radius |   opt    |  c viol  | penalty  |CG stop|</span>
<span class="go">|-------|-------|-------|-------------|----------|----------|----------|----------|-------|</span>
<span class="go">|   1   |   1   |   0   | +1.2497e-03 | 1.00e+00 | 1.08e-01 | 0.00e+00 | 1.00e+00 |   0   |</span>

<span class="go">--snip--</span>

<span class="go">|  100  |  100  | 2228  | +8.5451e-04 | 9.95e+00 | 2.47e-05 | 0.00e+00 | 1.00e+00 |   1   |</span>

<span class="go">--snip--</span>

<span class="go">==============================</span>
<span class="go">NONLINEAR PROGRAMMING COMPLETE</span>
<span class="go">==============================</span>
<span class="go">Time elapsed: 0 mins, 3 secs, 186 msecs</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> attribute has now been updated with the result obtained using
NLP. The routine also computes the errors associated with each parameter,
which can be accessed with <a class="reference internal" href="references/core.html#nmrespy.core.Estimator.get_errors" title="nmrespy.core.Estimator.get_errors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_errors()</span></code></a>.</p>
</section>
</section>
<section id="saving-results">
<h2>Saving Results<a class="headerlink" href="#saving-results" title="Permalink to this headline">¶</a></h2>
<section id="writing-results-to-a-text-file-pdf-csv">
<h3>Writing Results to a Text File/PDF/CSV<a class="headerlink" href="#writing-results-to-a-text-file-pdf-csv" title="Permalink to this headline">¶</a></h3>
<p>The estimation result can be written to <code class="docutils literal notranslate"><span class="pre">.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">.pdf</span></code> and <code class="docutils literal notranslate"><span class="pre">.csv</span></code>
formats, using the <a class="reference internal" href="references/core.html#nmrespy.core.Estimator.write_result" title="nmrespy.core.Estimator.write_result"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_result()</span></code></a> method.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Example estimation result for NMR-EsPy docs.&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">estimator</span><span class="o">.</span><span class="n">write_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Saved result to /&lt;pwd&gt;/example.txt</span>
<span class="go">Result successfully output to:</span>
<span class="go">/&lt;pwd&gt;/example.pdf</span>
<span class="go">If you wish to customise the document, the TeX file can be found at:</span>
<span class="go">/&lt;pwd&gt;/example.tex</span>
<span class="go">Saved result to /&lt;pwd&gt;/example.csv</span>
</pre></div>
</div>
<p>The files generated are as follows:</p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/4e584ad75b22e0ef6b9dfae5ec5b241c/example.txt"><code class="xref download docutils literal notranslate"><span class="pre">example.txt</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/dda2538393382235f29d13f99d8316f0/example.tex"><code class="xref download docutils literal notranslate"><span class="pre">example.tex</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/30c6c92f9c587eb6b8740a4eb05f86cd/example.pdf"><code class="xref download docutils literal notranslate"><span class="pre">example.pdf</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/d0dc38f43234f0b6709b5dc934e9ae6a/example.csv"><code class="xref download docutils literal notranslate"><span class="pre">example.csv</span></code></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to generate PDF files, you will need a LaTeX installation on
your system. See the documentation for the
<a class="reference internal" href="references/write.html#nmrespy.write.write_result" title="nmrespy.write.write_result"><code class="xref py py-func docutils literal notranslate"><span class="pre">nmrespy.write.write_result()</span></code></a> function for more details.</p>
</div>
</section>
<section id="generating-result-figures">
<h3>Generating Result Figures<a class="headerlink" href="#generating-result-figures" title="Permalink to this headline">¶</a></h3>
<p>To generate a figure of the result, you can use the
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.plot_result" title="nmrespy.core.Estimator.plot_result"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot_result()</span></code></a> method, which utilises
<a class="reference external" href="https://matplotlib.org/">matplotlib</a>. There is wide scope for customising
the plot, which is described in detail in
<a class="reference internal" href="misc/figure_customisation.html"><span class="doc">Figure Customisation</span></a>.
See <a class="reference internal" href="#summary">Summary</a> below for an example of some basic plot customisation.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">plot_result</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plot_example.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/b308158719da4b6f062b546fedc3862c/plot_example.png"><code class="xref download docutils literal notranslate"><span class="pre">example_plot.png</span></code></a></p></li>
</ul>
</section>
<section id="pickling-estimator-instances">
<h3>Pickling Estimator Instances<a class="headerlink" href="#pickling-estimator-instances" title="Permalink to this headline">¶</a></h3>
<p>The estimator instance can be serialised, and saved to a byte stream using
Python’s <a class="reference external" href="https://docs.python.org/3/library/pickle.html">pickle</a> module,
with <a class="reference internal" href="references/core.html#nmrespy.core.Estimator.to_pickle" title="nmrespy.core.Estimator.to_pickle"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_pickle()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;pickle_example&quot;</span><span class="p">)</span>
<span class="go">Saved instance of Estimator to /&lt;pwd&gt;/pickle_example.pkl</span>
</pre></div>
</div>
<p>The estimator can subsequently be recovered using
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.from_pickle" title="nmrespy.core.Estimator.from_pickle"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pickle()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator_cp</span> <span class="o">=</span> <span class="n">Estimator</span><span class="o">.</span><span class="n">from_pickle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;pickle_example&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">estimator_cp</span><span class="p">)</span>
<span class="go">&lt;class &#39;nmrespy.core.Estimator&#39;&gt;</span>
</pre></div>
</div>
</section>
<section id="saving-a-logfile">
<h3>Saving a Logfile<a class="headerlink" href="#saving-a-logfile" title="Permalink to this headline">¶</a></h3>
<p>A summary of the methods applied to the estimator can be saved using the
<a class="reference internal" href="references/core.html#nmrespy.core.Estimator.save_logfile" title="nmrespy.core.Estimator.save_logfile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_logfile()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">estimator</span><span class="o">.</span><span class="n">save_logfile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;logfile_example&quot;</span><span class="p">)</span>
<span class="go">Log file successfully saved to /&lt;pwd&gt;/logfile_example.log</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/7d46f78d7d879e8b0e7b49c9bd0b5d51/logfile_example.log"><code class="xref download docutils literal notranslate"><span class="pre">logfile_example.log</span></code></a></p></li>
</ul>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>A script which performs the entire procedure described above is as follows.
Note that further customisation has been applied to the plot to give it an
“aesthetic upgrade”.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmrespy.core</span> <span class="kn">import</span> <span class="n">Estimator</span>

<span class="c1"># Path to data. You&#39;ll need to change the 4.0.8 bit if you are using a</span>
<span class="c1"># different TopSpin version.</span>

<span class="c1"># --- UNIX users ---</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/opt/topspin4.0.8/examdata/exam1d_1H/1/pdata/1&quot;</span>

<span class="c1"># --- Windows users ---</span>
<span class="c1"># path = &quot;C:/Bruker/TopSpin4.0.8/examdata/exam1d_1H/1/pdata/1&quot;</span>

<span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="o">.</span><span class="n">new_bruker</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># --- Frequency filter &amp; estimate ---</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">frequency_filter</span><span class="p">([[</span><span class="mf">5.54</span><span class="p">,</span> <span class="mf">5.42</span><span class="p">]],</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">]])</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">matrix_pencil</span><span class="p">()</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">nonlinear_programming</span><span class="p">(</span><span class="n">phase_variance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># --- Write result files ---</span>
<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Example estimation result for NMR-EsPy docs.&quot;</span>
<span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">]:</span>
    <span class="n">estimator</span><span class="o">.</span><span class="n">write_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

<span class="c1"># --- Plot result ---</span>
<span class="c1"># Set oscillator colours using the viridis colourmap</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">plot_result</span><span class="p">(</span><span class="n">oscillator_colors</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="c1"># Shift oscillator labels</span>
<span class="c1"># Move the labels associated with oscillators 1, 2, 5, and 6</span>
<span class="c1"># to the right and up.</span>
<span class="n">plot</span><span class="o">.</span><span class="n">displace_labels</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="c1"># Move the labels associated with oscillators 3, 4, 7, and 8</span>
<span class="c1"># to the left and up.</span>
<span class="n">plot</span><span class="o">.</span><span class="n">displace_labels</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="c1"># Move oscillators 9&#39;s label to the right</span>
<span class="n">plot</span><span class="o">.</span><span class="n">displace_labels</span><span class="p">([</span><span class="mi">9</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="c1"># Save figure as a PNG</span>
<span class="n">plot</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plot_example_edited.png&quot;</span><span class="p">)</span>

<span class="c1"># Save the estimator to a binary file.</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;pickle_example&quot;</span><span class="p">)</span>

<span class="c1"># Save a logfile of method calls</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">save_logfile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;logfile_example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/5d8e1d4583f68e53627ad623da9172f9/nmrespy_example.py"><code class="xref download docutils literal notranslate"><span class="pre">nmrespy_example.py</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/c9484536ea090f7ceb0581a47898bade/plot_example_edited.png"><code class="xref download docutils literal notranslate"><span class="pre">plot_example_edited.png</span></code></a></p></li>
</ul>
<p>More features are provided by the <a class="reference internal" href="references/core.html#nmrespy.core.Estimator" title="nmrespy.core.Estimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Estimator</span></code></a> beyond
what is described on this page, but this gives an overview of the primary
functionality.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example Walkthrough</a><ul>
<li><a class="reference internal" href="#generating-an-estimator-instance">Generating an Estimator instance</a></li>
<li><a class="reference internal" href="#frequency-filtration">Frequency Filtration</a></li>
<li><a class="reference internal" href="#estimating-the-signal-parameters">Estimating the Signal Parameters</a><ul>
<li><a class="reference internal" href="#matrix-pencil-method">Matrix Pencil Method</a></li>
<li><a class="reference internal" href="#nonlinear-programming">Nonlinear Programming</a></li>
</ul>
</li>
<li><a class="reference internal" href="#saving-results">Saving Results</a><ul>
<li><a class="reference internal" href="#writing-results-to-a-text-file-pdf-csv">Writing Results to a Text File/PDF/CSV</a></li>
<li><a class="reference internal" href="#generating-result-figures">Generating Result Figures</a></li>
<li><a class="reference internal" href="#pickling-estimator-instances">Pickling Estimator Instances</a></li>
<li><a class="reference internal" href="#saving-a-logfile">Saving a Logfile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="theory_overview.html"
                        title="previous chapter">Theory Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="gui/index.html"
                        title="next chapter">The NMR-EsPy GUI</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/walkthrough.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gui/index.html" title="The NMR-EsPy GUI"
             >next</a> |</li>
        <li class="right" >
          <a href="theory_overview.html" title="Theory Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NMR-EsPy  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example Walkthrough</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Simon Hulse &amp; Mohammadali Foroozandeh.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.3.
    </div>
  </body>
</html>